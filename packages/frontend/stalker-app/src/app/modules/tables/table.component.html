<mat-card appearance="outlined">
  <mat-card-header>
    <div class="tw-w-full tw-flex tw-flex-wrap">
      <rk-placeholder *ngIf="(table$ | async) === null"></rk-placeholder>
      <mat-card-title class="tw-flex-1 tw-pb-3">
        {{ (table$ | async)?.name }}
      </mat-card-title>
    </div>
  </mat-card-header>

  <mat-card-content>
    @if (((projects$ | async) && (tags$ | async)) || true) {
      <app-filtered-paginated-table
        [isLoading]="(isLoading$ | async) ?? true"
        [length]="count$ | async"
        [dateSearchEnabled]="true"
      >
        <app-table-format
          [dataSource]="dataSource$ | async"
          [columns]="displayColumns$ | async"
          [routerLinkPrefix]="'/domains/'"
          [noDataMessage]="noDataMessage"
        >
          <!-- Domain Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef i18n="Name|The resource display name">Name</th>
            <td mat-cell *matCellDef="let element">
              <div class="tw-flex tw-flex-wrap tw-gap-2 tw-items-center">
                <a [routerLink]="'/domains/' + element._id" (click)="$event.stopPropagation()">{{ element.name }}</a>

                @if (element.blocked) {
                  <app-blocked-pill-tag></app-blocked-pill-tag>
                }
              </div>
            </td>
          </ng-container>

          <!-- Project Column -->
          <ng-container matColumnDef="project">
            <th mat-header-cell *matHeaderCellDef i18n="Project|A business">Project</th>
            <td mat-cell *matCellDef="let element">
              <project-cell [project]="projects$ | async | whereId: [element.projectId]"></project-cell>
            </td>
          </ng-container>

          <!-- Custom Column -->
          @for (customColumn of customColumns$ | async; track $index) {
            <ng-container [matColumnDef]="customColumn.id">
              <th mat-header-cell *matHeaderCellDef>{{ customColumn.name }}</th>
              <td mat-cell *matCellDef="let element"><rk-placeholder></rk-placeholder></td>
            </ng-container>
          }

          <!-- Tags Column -->
          <ng-container matColumnDef="tags">
            <th mat-header-cell *matHeaderCellDef i18n="Tags|Multiple tags describing somthing">Tags</th>
            <td mat-cell *matCellDef="let element">
              <div class="tw-pt-1 tw-flex tw-flex-wrap tw-gap-x-2 tw-gap-y-1">
                @for (tag of element.tags; track tag) {
                  <app-pill-tag [color]="(tags$ | async | whereId: [tag])?.color">{{
                    (tags$ | async | whereId: [tag])?.text
                  }}</app-pill-tag>
                }
                <app-new-pill-tag [createdAtMilliseconds]="element.createdAt"></app-new-pill-tag>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayColumns$ | async"></tr>
        </app-table-format>
      </app-filtered-paginated-table>
    }
  </mat-card-content>
</mat-card>
