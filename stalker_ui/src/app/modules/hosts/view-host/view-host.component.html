<div fxLayout="row" class="full-height">
  <div fxFlex>
    <div fxLayout="row" fxLayoutAlign="center">
      <mat-card fxFlex.lt-md="95" [fxFlex.gt-sm]="selectedDomain ? 95 : 80" *ngIf="(routeSub$ | async) || true">
        <mat-card-content>
          <h1 fxLayoutAlign="flex-start center">
            <button type="button" mat-icon-button routerLinkActive="list-item-active" routerLink="/hosts">
              <mat-icon class="material-icons-outlined">arrow_back</mat-icon>
            </button>
            <div *ngIf="host">{{ host.ip }}</div>
          </h1>

          <div fxLayout="row">
            <div fxFlex="65">
              <div fxLayout="column">
                <div fxFlex>
                  <h2 class="fake-mat-subheader" i18n="Ports|The ports of a host">
                    Ports {{ host && host.ports && host.ports.length > 0 ? '(' + host.ports.length + ')' : '' }}
                  </h2>
                  <div class="ports-div">
                    <mat-accordion *ngIf="host && host.ports && host.ports.length > 0" [multi]="true">
                      <mat-expansion-panel *ngFor="let port of host.ports; let i = index" hideToggle>
                        <mat-expansion-panel-header>
                          <mat-panel-title
                            ><label>{{ port }}</label>
                          </mat-panel-title>
                          <mat-panel-description
                            ><div fxLayout="row" fxLayoutAlign="flex-start center" class="full-width">
                              <!-- Add details here with further port implementation -->
                              <div fxFlex>No details yet</div>
                            </div>
                            <button
                              type="button"
                              mat-icon-button
                              i18n-matTooltip="Additonnal details|Additionnal information about an item"
                              matTooltip="Additionnal details"
                              matTooltipShowDelay="500"
                              routerLinkActive="list-item-active"
                              [routerLink]="'/hosts/' + host._id + '/' + port"
                            >
                              <mat-icon class="material-icons-outlined">navigate_next</mat-icon>
                            </button>
                          </mat-panel-description>
                        </mat-expansion-panel-header>
                        <!-- Add details here with further port implementation -->
                        <div>No details yet</div>
                      </mat-expansion-panel>
                    </mat-accordion>
                    <div
                      *ngIf="!(host && host.ports && host.ports.length > 0)"
                      fxLayout="row"
                      fxLayoutAlign="center center"
                    >
                      <p i18n="No TCP ports found|No open TCP ports were found on the host">
                        No open TCP ports were found
                      </p>
                    </div>
                  </div>
                </div>
                <mat-divider class="horizontal-divider-important" [inset]="true"></mat-divider>
                <div fxFlex>
                  <mat-form-field appearance="outline" class="full-width notes">
                    <mat-label i18n="Notes|Notes about an item">Notes</mat-label>
                    <textarea
                      readonly="true"
                      matInput
                      cdkTextareaAutosize
                      cdkAutosizeMinRows="8"
                      cdkAutosizeMaxRows="20"
                    ></textarea>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <mat-divider [vertical]="true" class="vertical-dvider"></mat-divider>
            <div fxFlex="35">
              <div fxLayout="column">
                <div fxFlex *ngIf="tags$ | async">
                  <h2 class="fake-mat-subheader" i18n="Tags|The tags of an item">Tags</h2>
                  <div fxLayout="row" fxLayoutAlign="center" *ngIf="!host || !host.tags || host.tags.length === 0">
                    <div>
                      <p i18n="No tags found|No tags were found for this item" fxFlex>No tags found</p>
                    </div>
                  </div>
                  <div fxLayout="row">
                    <div>
                      <app-pill-tag *ngFor="let tag of host?.tags" [color]="(tags | whereId: [tag])?.color">{{
                        (tags | whereId: [tag])?.text
                      }}</app-pill-tag>
                    </div>
                  </div>
                </div>

                <mat-form-field
                  appearance="outline"
                  class="full-width margin-top-10"
                  *ngIf="(companies$ | async) && host"
                >
                  <mat-label i18n="Company|A business">Company</mat-label>
                  <input
                    matInput
                    i18n-placeholder="Company|A business"
                    placeholder="Company"
                    readonly="true"
                    [ngModel]="(companies | whereId: [host.companyId]).name"
                  />
                </mat-form-field>

                <!-- <mat-divider class="horizontal-divider-important" [inset]="true"></mat-divider> -->

                <div class="table-container" fxFlex fxLayout="column">
                  <h2 class="fake-mat-subheader" i18n="Domain Names|Multiple domain names">Domain Names</h2>
                  <table mat-table [dataSource]="dataSource">
                    <!-- Domain name -->
                    <ng-container matColumnDef="domainName">
                      <td mat-cell *matCellDef="let element">{{ element.name }}</td>
                    </ng-container>

                    <tr
                      mat-row
                      *matRowDef="let row; columns: displayedColumns; let i = index"
                      class="rows rows-cursor"
                      (click)="selectDomainAndView(row)"
                      [class.selected-host]="selectedDomain?.id === row.id"
                      [class.first-cell]="i === 0"
                    ></tr>

                    <tr class="mat-row nodata" *matNoDataRow>
                      <td class="mat-cell" colspan="100%" i18n="No domains found|No domains were found for this item">
                        No domains found
                      </td>
                    </tr>
                  </table>

                  <mat-paginator
                    [length]="100"
                    [pageSize]="5"
                    [pageSizeOptions]="[5, 10, 25, 100]"
                    showFirstLastButtons
                    aria-label="Select page"
                  >
                  </mat-paginator>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
  <mat-drawer-container class="domain-side-nav" autosize="true">
    <mat-drawer closed mode="side" position="end">
      <mat-nav-list>
        <h2 matSubheader i18n="Domain|A domain name object">Domain</h2>
        <a
          *ngIf="selectedDomain"
          mat-list-item
          routerLinkActive="list-item-active"
          [routerLink]="['/domains/', selectedDomain.id]"
          matTooltipPosition="right"
        >
          <mat-icon class="material-icons-outlined">language</mat-icon>
          <span class="domain-name">{{ selectedDomain.name }}</span>
        </a>
      </mat-nav-list>
      <mat-divider class="horizontal-divider"></mat-divider>
      <div *ngIf="domainDetails$ | async" fxLayout="column">
        <div class="drawer-item" fxFlex>
          <h2 class="fake-mat-subheader" i18n="Tags|The tags of an item">Tags</h2>
          <div
            fxLayout="row"
            fxLayoutAlign="center"
            *ngIf="!domainDetails || !domainDetails.tags || domainDetails.tags.length === 0"
          >
            <div>
              <p i18n="No tags found|No tags were found for this item" fxFlex>No tags found</p>
            </div>
          </div>
          <div fxLayout="row">
            <div>
              <app-pill-tag *ngFor="let tag of domainDetails?.tags" [color]="(tags | whereId: [tag])?.color">{{
                (tags | whereId: [tag])?.text
              }}</app-pill-tag>
            </div>
          </div>
        </div>

        <mat-divider class="horizontal-divider" fxFlex></mat-divider>
        <div fxFlex>
          <div class="drawer-item" fxLayout="column">
            <h2 class="fake-mat-subheader" i18n="Hosts|The hosts of a domain" fxFlex>Hosts</h2>
            <div fxFlex>
              <div class="table-container-domain" *ngIf="domainsHostDataSource" fxFlex>
                <table mat-table [dataSource]="domainsHostDataSource">
                  <!-- Host IP Column -->
                  <ng-container matColumnDef="hostIp">
                    <td mat-cell *matCellDef="let element">{{ element.ip }}</td>
                  </ng-container>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: ['hostIp']; let i = index"
                    class="rows rows-cursor"
                    [class.first-cell]="i === 0"
                    routerLinkActive="list-item-active"
                    [routerLink]="['/hosts/', row.id]"
                  ></tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <mat-divider class="horizontal-divider" fxFlex></mat-divider>

        <div class="drawer-item last-drawer-item" fxFlex>
          <h2 class="fake-mat-subheader" i18n="General|Generic information title">General</h2>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="Company|A business">Company</mat-label>
            <input
              matInput
              i18n-placeholder="Company|A business"
              placeholder="Company"
              name="company"
              readonly="true"
              [value]="(companies | whereId: [domainDetails?.companyId]).name"
            />
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width notes">
            <mat-label i18n="Notes|Notes about an item">Notes</mat-label>
            <textarea readonly="true" matInput cdkTextareaAutosize cdkAutosizeMinRows="8" cdkAutosizeMaxRows="20">{{
              domainDetails?.notes
            }}</textarea>
          </mat-form-field>
        </div>
      </div>
    </mat-drawer>
  </mat-drawer-container>
</div>
