<div fxLayout="row" class="full-height">
  <div fxFlex>
    <div fxLayout="row" fxLayoutAlign="center">
      <mat-card fxFlex.lt-md="95" [fxFlex.gt-sm]="selectedHost ? 95 : 80" *ngIf="(routeSub$ | async) || true">
        <mat-card-content>
          <h1 fxLayoutAlign="flex-start center">
            <button type="button" mat-icon-button routerLinkActive="list-item-active" routerLink="/domains">
              <mat-icon class="material-icons-outlined">arrow_back</mat-icon>
            </button>
            <div *ngIf="domain">{{ domain.name }}</div>
          </h1>

          <div fxLayout="row">
            <div fxFlex="65">
              <div fxLayout="column">
                <div class="table-container" *ngIf="domain" fxFlex fxLayout="column">
                  <table mat-table [dataSource]="dataSource">
                    <!-- IP Address Column -->
                    <ng-container matColumnDef="ipAddress">
                      <th mat-header-cell *matHeaderCellDef i18n="IP Address|A host's IP address">IP Address</th>
                      <td mat-cell *matCellDef="let element">{{ element.ip }}</td>
                    </ng-container>

                    <!-- Ports -->
                    <ng-container matColumnDef="ports">
                      <th mat-header-cell *matHeaderCellDef i18n="Top ports|An overview of the top ports of the hosts">
                        Top Ports
                      </th>
                      <td mat-cell *matCellDef="let element">
                        <label class="port" *ngFor="let p of element.ports; let i = index"
                          ><span *ngIf="i != element.ports.length - 1; else lastPort">{{ p }},</span
                          ><ng-template #lastPort>{{ p }}</ng-template></label
                        >
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr
                      mat-row
                      *matRowDef="let row; columns: displayedColumns"
                      class="rows rows-cursor"
                      (click)="selectHostAndView(row)"
                      [class.selected-host]="selectedHost?.id === row.id"
                    ></tr>

                    <tr class="mat-row nodata" *matNoDataRow>
                      <td class="mat-cell" colspan="100%" i18n="No hosts found|No hosts were found for this item">
                        No hosts found
                      </td>
                    </tr>
                  </table>

                  <mat-paginator
                    [length]="100"
                    [pageSize]="10"
                    [pageSizeOptions]="[5, 10, 25, 100]"
                    showFirstLastButtons
                    aria-label="Select page"
                  >
                  </mat-paginator>
                </div>
                <div fxFlex>
                  <mat-form-field appearance="outline" class="full-width notes">
                    <mat-label i18n="Notes|Notes about an item">Notes</mat-label>
                    <textarea
                      readonly="true"
                      matInput
                      cdkTextareaAutosize
                      cdkAutosizeMinRows="8"
                      cdkAutosizeMaxRows="20"
                    ></textarea>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <mat-divider [vertical]="true" class="vertical-dvider"></mat-divider>
            <div fxFlex="35">
              <div fxLayout="column">
                <div fxFlex>
                  <h2 class="fake-mat-subheader" i18n="Tags|The tags of an item">Tags</h2>
                  <div
                    fxLayout="row"
                    fxLayoutAlign="center"
                    *ngIf="!domain || !domain.tags || domain.tags.length === 0"
                  >
                    <div>
                      <p i18n="No tags found|No tags were found for this item" fxFlex>No tags found</p>
                    </div>
                  </div>
                  <div fxLayout="row">
                    <div>
                      <app-pill-tag *ngFor="let tag of domain?.tags" [color]="(tags | whereId: [tag])?.color">{{
                        (tags | whereId: [tag])?.text
                      }}</app-pill-tag>
                    </div>
                  </div>
                </div>

                <mat-form-field appearance="outline" class="full-width margin-top-10" *ngIf="domain && companies">
                  <mat-label i18n="Company|A business">Company</mat-label>
                  <input
                    matInput
                    i18n-placeholder="Company|A business"
                    placeholder="Company"
                    readonly="true"
                    [value]="(companies | whereId: [domain.companyId]).name"
                  />
                </mat-form-field>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <mat-drawer-container class="host-side-nav" autosize="true" *ngIf="((companies$ | async) && (tags$ | async)) || true">
    <mat-drawer closed mode="side" position="end">
      <mat-nav-list>
        <h2 matSubheader i18n="Host|A host object, a server">Host</h2>
        <a
          *ngIf="selectedHost"
          mat-list-item
          routerLinkActive="list-item-active"
          routerLink="{{ '/hosts/' + selectedHost.id }}"
          matTooltipPosition="right"
        >
          <mat-icon class="material-icons-outlined">dns</mat-icon>
          <span class="ip-address">{{ selectedHost.ip }}</span>
        </a>
      </mat-nav-list>
      <mat-divider class="horizontal-divider"></mat-divider>
      <div *ngIf="hostDetails$ | async" fxLayout="column">
        <div class="drawer-item" fxFlex>
          <h2 class="fake-mat-subheader" i18n="Tags|The tags of an item">Tags</h2>
          <div
            fxLayout="row"
            fxLayoutAlign="center"
            *ngIf="!hostDetails || !hostDetails.tags || hostDetails.tags.length === 0"
          >
            <div>
              <p i18n="No tags found|No tags were found for this item" fxFlex>No tags found</p>
            </div>
          </div>
          <div fxLayout="row">
            <div>
              <app-pill-tag *ngFor="let tag of hostDetails?.tags" [color]="(tags | whereId: [tag])?.color">{{
                (tags | whereId: [tag])?.text
              }}</app-pill-tag>
            </div>
          </div>
        </div>

        <mat-divider class="horizontal-divider" fxFlex></mat-divider>
        <div fxFlex>
          <div class="drawer-item" fxLayout="column">
            <h2 class="fake-mat-subheader" i18n="Domains|The domains of a host" fxFlex>Domains</h2>
            <div fxFlex>
              <div class="table-container-host" *ngIf="hostDomainsDataSource" fxFlex>
                <table mat-table [dataSource]="hostDomainsDataSource">
                  <!-- Domain Name Column -->
                  <ng-container matColumnDef="hostDomainName">
                    <td mat-cell *matCellDef="let element">{{ element.name }}</td>
                  </ng-container>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: ['hostDomainName']; let i = index"
                    class="rows rows-cursor"
                    [class.first-cell]="i === 0"
                    routerLinkActive="list-item-active"
                    [routerLink]="['/domains/', row.id]"
                  ></tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <mat-divider class="horizontal-divider" fxFlex></mat-divider>

        <div fxFlex>
          <div class="drawer-item" fxLayout="column">
            <h2 class="fake-mat-subheader" i18n="Ports|The ports of a host" fxFlex>Ports</h2>
            <div fxFlex>
              <div
                fxLayout="row"
                fxLayoutAlign="center"
                *ngIf="!hostPortsDataSource || !hostPortsDataSource.data || hostPortsDataSource.data.length === 0"
              >
                <div>
                  <p i18n="No ports found|No ports were found for this item" fxFlex>No ports found</p>
                </div>
              </div>
              <div class="table-container-host" *ngIf="hostPortsDataSource">
                <table mat-table [dataSource]="hostPortsDataSource">
                  <!-- Ports Column -->
                  <ng-container matColumnDef="hostPort">
                    <td mat-cell *matCellDef="let element">{{ element }}</td>
                  </ng-container>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: ['hostPort']; let i = index"
                    class="rows"
                    [class.first-cell]="i === 0"
                  ></tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <mat-divider class="horizontal-divider" fxFlex></mat-divider>
        <div class="drawer-item last-drawer-item" fxFlex>
          <h2 class="fake-mat-subheader" i18n="General|Generic information title">General</h2>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label i18n="Company|A business">Company</mat-label>
            <input
              matInput
              i18n-placeholder="Company|A business"
              placeholder="Company"
              name="company"
              readonly="true"
              [value]="(companies | whereId: [hostDetails?.companyId]).name"
            />
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width notes">
            <mat-label i18n="Notes|Notes about an item">Notes</mat-label>
            <textarea readonly="true" matInput cdkTextareaAutosize cdkAutosizeMinRows="8" cdkAutosizeMaxRows="20">{{
              hostDetails?.notes
            }}</textarea>
          </mat-form-field>
        </div>
      </div>
    </mat-drawer>
  </mat-drawer-container>
</div>
